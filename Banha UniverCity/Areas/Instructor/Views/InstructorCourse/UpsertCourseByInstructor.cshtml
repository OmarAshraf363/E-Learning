@using Banha_UniverCity.ViewModels
@model CourseVM
@{
    ViewData["Title"] = Model.CourseID == 0 ? "Create New Course" : "Edit Course";
}

<style>


    .card {
        background-color: #23272a;
        border: none;
        border-radius: 12px;
    }

    .form-control,
    .form-select {
        background-color: #2c2f33;
        color: #fff;
        border: 1px solid #444;
        border-radius: 6px;
    }

        .form-control:focus {
            border-color: #17a2b8;
            box-shadow: 0 0 0 0.25rem rgba(23, 162, 184, 0.25);
        }

    label {
        font-weight: bold;
        color: #17a2b8;
    }

    .btn {
        border-radius: 6px;
    }

    .image-preview {
        width: 100%;
        height: 200px;
        border: 1px dashed #ccc;
        background-color: #2e2e2e;
        background-size: cover;
        background-position: center;
        margin-top: 10px;
    }

    .section-title {
        border-left: 4px solid #17a2b8;
        padding-left: 10px;
        margin-bottom: 15px;
        font-size: 1.2rem;
        color: #17a2b8;
    }

    .btn-group .btn {
        width: 48%;
    }
</style>

<div class="container mt-5">
    <div class="card p-4 shadow-lg">
        @if (ViewBag.errorr != null)
        {
            <p class="text-danger">@ViewBag.errorr</p>
        }
        <h2 class="text-info mb-4">
            @if (Model.CourseID == 0)
            {
                <i class="fas fa-plus-circle"></i>
                @: Create New Course
            }
            else
            {
                <i class="fas fa-edit"></i>
                @: Edit Course: < span class= "text-warning" > @Model.CourseName </ span >
            }
        </h2>

        <form asp-action="Upsert" enctype="multipart/form-data">
            <input asp-for="CourseID" type="hidden" />
            <input asp-for="InstructorId" type="hidden" />
            <input asp-for="DepartmentId" type="hidden" />

            <div class="row">
                <!-- Image Upload -->
                <div class="col-md-4">
                    <label class="form-label">Cover Image</label>
                    <input type="file" asp-for="ImgCover" class="form-control" onchange="previewImage(this)" />
                    <div class="image-preview mt-2" id="imagePreview" style="background-image: url('/Covers/@Model.ImgCover');">
                    </div>
                </div>

                <!-- Main Info -->
                <div class="col-md-8">
                    <div class="form-group mb-3">
                        <label asp-for="CourseName"></label>
                        <input asp-for="CourseName" class="form-control" placeholder="Course Name" />
                        <span asp-validation-for="CourseName" class="text-danger"></span>
                    </div>

                    <div class="form-group mb-3">
                        <label asp-for="Description"></label>
                        <textarea asp-for="Description" class="form-control" rows="3" placeholder="Course Description"></textarea>
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <label asp-for="Price"></label>
                            <input asp-for="Price" class="form-control" type="number" step="0.01" />
                            <span asp-validation-for="Price" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="Credits"></label>
                            <input asp-for="Credits" class="form-control" />
                            <span asp-validation-for="Credits" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <label asp-for="Rate"></label>
                            <input asp-for="Rate" class="form-control" type="number" min="1" max="5" />
                            <span asp-validation-for="Rate" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="NumOfEnrollments"></label>
                            <input asp-for="NumOfEnrollments" class="form-control" />
                            <span asp-validation-for="NumOfEnrollments" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="form-group mt-3">
                        <label asp-for="DemoVideoUrl"></label>
                        <input asp-for="DemoVideoUrl" class="form-control" placeholder="Video URL" />
                        <span asp-validation-for="DemoVideoUrl" class="text-danger"></span>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <label asp-for="StartDate"></label>
                            <input asp-for="StartDate" class="form-control" type="date" />
                            <span asp-validation-for="StartDate" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="EndDate"></label>
                            <input asp-for="EndDate" class="form-control" type="date" />
                            <span asp-validation-for="EndDate" class="text-danger"></span>
                        </div>
                      
                    </div>
                   
                </div>
            </div>
            <div class="form-group mt-3">
                <label asp-for="TrackId">Pick Track</label>
                <select class="form-select-lg" asp-for="TrackId">
                    <option value="">Select Track</option>

                    @foreach (var item in Model.Tracks)
                    {
                        <option value="@item.Id">@item.Name</option>

                    }
                </select>
            </div>
            <div class="form-group mt-3">
                <label asp-for="DepartmentId">Pick Department</label>
                <select class="form-select-lg" asp-for="DepartmentId">
                    <option value="">Select Department</option>

                    @foreach (var item in Model.Departments)
                    {
                        <option value="@item.DepartmentID">@item.DepartmentName</option>

                    }
                </select>
            </div>

            <!-- Keywords -->
            <div class="mt-4">
                <div class="section-title">Keywords</div>
                <button type="button" class="btn btn-sm btn-outline-info mb-2" onclick="addField('keyWordsContainer', 'KeyWords', 'Name')">
                    <i class="fas fa-plus"></i> Add Keyword
                </button>
                <div id="keyWordsContainer">
                    @for (int i = 0; i < Model.KeyWords.Count; i++)
                    {
                        <input class="form-control mb-2" asp-for="KeyWords[@i].Name" placeholder="Keyword" />
                    }
                </div>
            </div>

            <!-- Objectives and Topics -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="section-title">Learning Objectives</div>
                    <button type="button" class="btn btn-sm btn-outline-info mb-2" onclick="addField('objectivesContainer', 'LearningObjectives', 'Objective')">
                        <i class="fas fa-plus"></i> Add Objective
                    </button>
                    <div id="objectivesContainer">
                        @for (int i = 0; i < Model.LearningObjectives.Count; i++)
                        {
                            <textarea class="form-control mb-2" asp-for="LearningObjectives[@i].Objective" placeholder="Objective"></textarea>
                        }
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="section-title">Topics Covered</div>
                    <button type="button" class="btn btn-sm btn-outline-info mb-2" onclick="addField('topicsContainer', 'TopicCovereds', 'Topic')">
                        <i class="fas fa-plus"></i> Add Topic
                    </button>
                    <div id="topicsContainer">
                        @for (int i = 0; i < Model.TopicCovereds.Count; i++)
                        {
                            <textarea class="form-control mb-2" asp-for="TopicCovereds[@i].Topic" placeholder="Topic"></textarea>
                        }
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="btn-group mt-4 d-flex justify-content-between">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-check"></i> @(Model.CourseID == 0 ? "Create" : "Update")
                </button>
                <a asp-action="Index" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Cancel</a>
            </div>
        </form>
    </div>
</div>

<!-- Scripts -->
<script>
    let keyWordIndex = @Model.KeyWords.Count;
    let objectiveIndex = @Model.LearningObjectives.Count;
    let topicIndex = @Model.TopicCovereds.Count;

    function addField(containerId, name, prop) {
        let index = 0;
        switch (name) {
            case 'KeyWords': index = keyWordIndex++; break;
            case 'LearningObjectives': index = objectiveIndex++; break;
            case 'TopicCovereds': index = topicIndex++; break;
        }

        const container = document.getElementById(containerId);
        const input = document.createElement(name === 'KeyWords' ? 'input' : 'textarea');
        input.className = 'form-control mb-2';
        input.setAttribute('name', `${name}[${index}].${prop}`);
        input.setAttribute('placeholder', prop);
        container.appendChild(input);
    }

    function previewImage(input) {
        const preview = document.getElementById('imagePreview');
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = e => preview.style.backgroundImage = `url('${e.target.result}')`;
            reader.readAsDataURL(file);
        }
    }
</script>
